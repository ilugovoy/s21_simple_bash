# Simple Bash Utils

## Оглавление
* [Введение](#введение)
* [Сборка](#сборка)
* [Тесты](#тесты)

## Введение

Реализация утилит cat и grep на языке программирования Си стандарта C11.

### Использование s21_cat  

s21_cat используется для печати содержимого файлов на экран с возможностью форматирования вывода.

`./s21_cat [ФЛАГ(И)] [ФАЙЛ(Ы)]...`

### Опции s21_cat  

Вот список флагов, которые ты можешь использовать с программой:

- n или "--number": выведет содержимое файла с номерами строк.  
- b или "--number-nonblank": выведет только непустые строки с номерами строк.  
- s или "--squeeze-blank": выведет содержимое файла без повторяющихся пустых строк.  
- e или --show-ends: выведет содержимое файла с символом '$' в конце каждой строки.  
- v выведет непечатные символы кроме табуляции и $, которые выводятся подключением -e -t.  
- t или "--show-tabs": "./s21_cat -t filename" выведет ^I вместо TAB.


### Использование s21_grep  

s21_grep позволяет искать и выводить строки, содержащие заданный паттерн в указанных файлах.  

`./s21_grep [ФЛАГ(И)] [ПАТТЕРН(Ы)] [ФАЙЛ(Ы)]`  

### Опции s21_grep  

Вот список флагов, которые ты можешь использовать с программой:  

- e (pattern): позволяет указывать один или несколько шаблонов поиска с использованием регулярных выражений.  
- i (ignore-case): игнорирует регистр при поиске паттерна;  
- v (invert-match): инвертирует результаты поиска, выводя строки, которые не содержат паттерн;  
- c (count): выводит только количество строк, содержащих паттерн, вместо самих строк;  
- l (files-with-matches): выводит только имена файлов, содержащих паттерн, вместо строк с вхождениями;  
- n (line-number): добавляет номера строк перед каждой строкой с вхождением паттерна;  
- h (no-filename): скрывает вывод имен файлов, содержащих паттерн;  
- s (silent): скрывает все сообщения об ошибках при работе с файлами;  
- f (file): указывает файл, из которого будут считаны строки вместо задания паттерна непосредственно в командной строке;  


## Сборка

```
$ git clone https://github.com/ilugovoy/s21_simple_bash_utils.git 
```

### s21_cat  
```
$ cd s21_SimpleBashUtils/src/cat  
$ make test
```

### s21_grep  
```
$ cd s21_SimpleBashUtils/src/grep  
$ make test
```

## Тесты
Unit-тесты реализованы при помощи bash-скриптов (src/cat/tests/unit_tests_cat.sh и src/grep/unit_tests/unit_tests_grep.sh).  
Тесты сравнивают результаты работы стандартных cat и grep с результатами s21_cat и s21_grep через diff.   
Во время выполения юнит-тестов также проводится выборочное тестирование на утечки утилитами `leaks` или `valgrind` в зависимости от ОС.  
После завершения работы скрипта с юнит-тестами, проводится проверка на стиль и cppcheck. 
**Тесты работают адекватно только на англоязычных системах.** 

Если все тесты прошли успешно, то файлы с логами будут удалены, а общая информация по всем пройденным тестам останется в файле `tests_result.log` 
Информацию о пройденных тестах на утечки можно найти в файле `leak_test.log`  

Тестирование можно провести одновременно с сборкой программы командой `make test`.  
Для корректной работы тестов на MacOS нужны `coreutils` и `grep` из пакета `Homebrew`.  
При первом вводе команды `make test` будет произведена проверка наличия нужных пакетов скриптом `install_brew.sh` из cat/tests.  
Если они не установлены, то во время выполнения команды `make test` нужные пакеты будут установлены и загружены. Время установки: 5-7 минут.   

**Директория `src/grep` не содержит скрипта для проверки наличия brew на MacOs, поэтому нужно проводить проверку, начиная с `s21_cat`.** 
  
По завершению работы команды `make test` будет выведено примерно такое сообщение:   
```  
  C3_SimpleBashUtils-1/src/cat$ make test  
  mkdir -p obj  
  gcc -Wall -Werror -Wextra -c -std=c11 -pedantic s21_cat.c -o obj/s21_cat.o  
  gcc -Wall -Werror -Wextra -c -std=c11 -pedantic s21_cat_func.c -o obj/s21_cat_func.o  
  gcc obj/s21_cat.o obj/s21_cat_func.o s21_cat_func.h -o s21_cat  
  Другая операционная система, не требуется установка Homebrew.  
  rm -f obj/*.o  
  
  START SINGLE FLAG TESTING s21_cat------------------>  
  All tests done! cat.log & s21_cat.log deleted.  
  TESTING COMPLETED SUCCESFULLY!!----------------------->  
  LEAK TEST SUCCESFULLY : 7  
  SUCCESS: 42  
  FAIL: 0  
  Хочешь запустить вторую партию тестов для составных флагов? (y/n):y  
  
  START COMPOSITE FLAGS TESTING s21_cat-------------->  
  All tests done! cat.log & s21_cat.log deleted.  
  TESTING COMPLETED SUCCESFULLY!!----------------------->  
  LEAK TEST SUCCESFULLY : 10  
  SUCCESS: 1554  
  FAIL: 0  
  Checking s21_cat.c ...  
  1/3 files checked 4% done  
  Checking s21_cat_func.c ...  
  2/3 files checked 79% done  
  Checking s21_cat_func.h ...  
  3/3 files checked 100% done  
  
  START STYLE TESTING src/cat/files.c && files.h------>  
  Файл ../s21_cat.c соответствует стилю форматирования aka Google style  
  Файл ../s21_cat_func.c соответствует стилю форматирования aka Google style  
  Файл ../s21_cat_func.h соответствует стилю форматирования aka Google style  
``` 

- Если тебе нужно, чтобы тестирование продолжалось даже если тесты проваливаются, запиши в `DONT_STOP_FLAG=0` в файле `unit_tests_.sh` в папке с тестами.  
- Чтобы отключить проверку на утечки, установи `LEAK_TEST_FLAG=0`  

### Tests scripts
Инструкция по работе со скриптами `unit_tests_cat.sh` и `unit_tests_grep.sh`:  
  
- Скрипт находится в папке с тестами - `src/cat/s21_cat_tests` или `src/grep/unit_tests`  
- Скрипт проходит по .txt файлам из папки, выполняя серию тестов с различными опциями команды и сравнивает вывод программы s21_cat или s21_grep с выводом системного cat/grep для каждого теста   
- Если тест выявил ошибку, то программа остановится, а подробности можно увидеть в файле `tests_result.log`, а в файлах `s21_cat/grep.log` и `sys_cat/grep.log` можно сравнить вывод с оригинальным системными утилитами     
